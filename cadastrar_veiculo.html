<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Cadastrar Veículos</title>
    <link rel="stylesheet" href="style_index.css">
    <link rel="stylesheet" href="style_crud.css"> <!-- Adicionado para consistência -->
    <link rel="stylesheet" href="cadastrar_veiculo.css">

</head>
<body>

    <header-placeholder></header-placeholder>

    <main class="main-content">
        <div class="content-card"> <!-- Alterado para content-card para consistência -->
            <h1>Cadastro de Veículos</h1>
            <p>Preencha as informações abaixo.</p>
            <hr>
            <form id="vehicle-registration-form" class="crud-form"> <!-- Adicionada classe crud-form -->
                <div class="form-group">
                    <label for="vehicle-quantity">Quantos veículos deseja cadastrar?</label>
                    <input type="number" id="vehicle-quantity" name="vehicle-quantity" class="form-control" min="1" placeholder="Digite a quantidade de veículos" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
                </div>

                <!-- Os campos dos veículos serão inseridos aqui dinamicamente -->
                <div id="vehicle-forms-container"></div>

                <button type="submit" class="btn btn-create">Cadastrar Veículos</button>
            </form>

            <div class="crud-navigation">
                <a href="listar.html" class="btn btn-read">Listar</a>
                <a href="atualizar.html" class="btn btn-update">Atualizar</a>
                <a href="excluir.html" class="btn btn-delete">Excluir</a>
                <a href="login.html" class="btn btn-secondary">Voltar ao Menu</a>
            </div>
        </div>
    </main>

    <footer-placeholder></footer-placeholder>

    <script src="main.js"></script>
    <script>
        document.getElementById('vehicle-quantity').addEventListener('input', function() {
            const quantity = parseInt(this.value, 10) || 0;
            const container = document.getElementById('vehicle-forms-container');
            container.innerHTML = ''; // Limpa os campos existentes

            for (let i = 1; i <= quantity; i++) {
                const vehicleBlockHTML = `
                    <div class="vehicle-block">
                        <h3>Veículo ${i}</h3>
                        <label for="tipo_veiculo_${i}">Tipo do Veículo:</label>
                        <select id="tipo_veiculo_${i}" name="tipo_veiculo_${i}"><option value="carro">Carro</option><option value="moto">Moto</option></select>
                        
                        <label for="modelo_${i}">Modelo:</label>
                        <input type="text" id="modelo_${i}" name="modelo_${i}" required>
                        
                        <label for="placa_${i}">Placa:</label>
                        <input type="text" id="placa_${i}" name="placa_${i}" required>
                        
                        <label for="cor_${i}">Cor:</label>
                        <input type="text" id="cor_${i}" name="cor_${i}" required>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', vehicleBlockHTML);
            }
        });

        document.getElementById('vehicle-registration-form').addEventListener('submit', function(event) {
            event.preventDefault(); // Impede o envio padrão do formulário

            const quantity = parseInt(document.getElementById('vehicle-quantity').value, 10) || 0;
            if (quantity === 0) {
                alert('Por favor, insira uma quantidade de veículos válida.');
                return;
            }

            const existingVehicles = JSON.parse(localStorage.getItem('vehicles')) || [];
            const existingPlates = new Set(existingVehicles.map(v => v.placa));
            const newVehicles = [];
            const newPlatesInBatch = new Set();

            for (let i = 1; i <= quantity; i++) {
                const placa = document.getElementById(`placa_${i}`).value;

                // Verifica duplicidade na submissão atual
                if (newPlatesInBatch.has(placa)) {
                    alert(`Placa duplicada no formulário: ${placa}. Por favor, insira placas únicas para cada veículo.`);
                    return;
                }

                // Verifica se a placa já existe no localStorage
                if (existingPlates.has(placa)) {
                    alert(`A placa ${placa} (Veículo ${i}) já está cadastrada. Por favor, insira uma placa diferente.`);
                    return;
                }

                newPlatesInBatch.add(placa);

                const vehicle = {
                    tipo: document.getElementById(`tipo_veiculo_${i}`).value,
                    modelo: document.getElementById(`modelo_${i}`).value,
                    placa: placa,
                    cor: document.getElementById(`cor_${i}`).value,
                };
                newVehicles.push(vehicle);
            }

            const updatedVehicles = existingVehicles.concat(newVehicles);
            localStorage.setItem('vehicles', JSON.stringify(updatedVehicles));
            alert('Veículo(s) cadastrado(s) com sucesso!');
            window.location.href = 'listar.html'; // Redireciona para a página de listagem
        });
    </script>
</body>
</html>